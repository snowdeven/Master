#!/bin/bash -l
#
#$ -V
#$ -q parallel.q
#$ -pe mpi 32
#$ -l h_vmem=0.5G
#$ -o $JOB_NAME.$JOB_ID.out
#$ -e $JOB_NAME.$JOB_ID.err
#$ -N Volume


# chargement des modules
module purge
module load vasp/5.4

# path definition
WORKDIR=$WORK/$JOB_NAME
if [ ! -d $WORKDIR ]; then
  mkdir $WORKDIR
fi

# copie des inputs/exec dans le repertoire de travail
for input in INCAR POTCAR KPOINTS; do 
  cp $input $WORKDIR
done
cd $WORKDIR

#for i in 11.10 11.25 11.40 11.65 11.80 11.95 12.10 12.25 12.40
for i in $(seq 11.10 0.15 12.40 | tr ',' '.')
do


cat >POSCAR <<!
 N2 clathrate hydrate : sI-Takeuchi with
   1.00000000000000     
    $i                    0.0000000000000000    0.0000000000000000
     0.0000000000000000   $i                    0.0000000000000000
     0.0000000000000000    0.0000000000000000   $i
   O    H    N 
    46    92    16
Direct
  0.0088555522468147  0.0078410057518901  0.2582824674143928
  0.0068802409488120  0.0084066444636742  0.7581532097337564
  0.0083109990711104  0.2008513082041596  0.1275065866025373
  0.0088767560586387  0.2009266566885324  0.8912270091191394
  0.0076552207332728  0.8149818199115841  0.1263244860689767
  0.0079758518743884  0.8152111093547233  0.8893084598834079
  0.5090526487245484  0.2582454920480070  0.0081485989566890
  0.5071312781645564  0.7583047395767728  0.0076388427394419
  0.5086359702917052  0.1254584733260983  0.2023828957608630
  0.5088791332618500  0.8896606343683924  0.2016498641416531
  0.5076242475064540  0.1272504474825958  0.8140961363228321
  0.5079038747713468  0.8913476564389313  0.8134765417309523
  0.3150124756338455  0.3894003166185662  0.0087552026297814
  0.3156493791199923  0.6246424003342167  0.0086374487633154
  0.1994327988139792  0.0090756290317274  0.3919502998613397
  0.2002331909618733  0.0081421995211513  0.6270480327120950
  0.1925404881772432  0.3237290862973692  0.1921652013537272
  0.1914735032227566  0.3234463592434348  0.8240556696610954
  0.1939652962950699  0.6922628527605247  0.1923925609929099
  0.1920171784225249  0.6912535977891019  0.8254365913830100
  0.3239248603866882  0.1909451805406283  0.3246603580699098
  0.3243452631628261  0.8261047733683541  0.3245569170796749
  0.3234441083602342  0.1919080243278113  0.6912951538969533
  0.3236127703396994  0.8237495764065687  0.6929269366840654
  0.7008224752800323  0.3917668638826306  0.0070512937149437
  0.7014281861842420  0.6272970952999715  0.0077647931768747
  0.8154036450199476  0.0082174876576212  0.3897357739270051
  0.8161948463639205  0.0069437873804668  0.6249435554135134
  0.8247519938444350  0.3258478451432133  0.1904084498667244
  0.8236726897200645  0.3239403677134624  0.8238016580366351
  0.8246218715046389  0.6930172764165971  0.1927561575855658
  0.8242454135486329  0.6917205942581697  0.8242582225302654
  0.6930619606172451  0.1928441576729764  0.3229448206381567
  0.6922477260498020  0.8244440749484192  0.3253453711474298
  0.6924393558641598  0.1909874903789000  0.6920519562051838
  0.6926091694230490  0.8246064936447658  0.6920164370312974
  0.2583013783245626  0.5079029131527075  0.5077740098116204
  0.7580849955977420  0.5079802480938512  0.5081708730495591
  0.1254184086567247  0.5073068245362781  0.7007460047525814
  0.8902956941266945  0.5086372929035904  0.7009700391086544
  0.1269833653615085  0.5072734238801189  0.3146724330270097
  0.8916849160617675  0.5092679428143312  0.3152290327398886
  0.3913251987161957  0.3148309072665987  0.5081459517294982
  0.6267117836021511  0.3150297942643639  0.5071059259758276
  0.3901039234893661  0.7008780759321523  0.5089085349780188
  0.6254196606479797  0.7011003632118477  0.5082758488885045
  0.9397146379432635  0.0097519510700429  0.3070854526929456
  0.0064298268729562  0.0770486944556327  0.2094067452105861
  0.0761004942971714  0.0065006352370930  0.7094358025481530
  0.0093386230882114  0.9392835556384254  0.8070875540061926
  0.9403983408081537  0.2474708262680569  0.1483666871723697
  0.0072726757094306  0.1936542412108351  0.0432609840397414
  0.0076266928458517  0.1292350304977548  0.8461012083318463
  0.9408611232390393  0.2451779291828209  0.8666267264804810
  0.0087392806015251  0.8867830504373752  0.1713165026985636
  0.0759674785747553  0.7710409254835239  0.1505778723983227
  0.0760977997388854  0.7690100021236645  0.8682335106026992
  0.0091445046104915  0.8223581647973215  0.9735046349474060
  0.4398479295289350  0.3069085790955204  0.0060922712398971
  0.5068252445204525  0.2094542307454212  0.9389657812333521
  0.5764471752595879  0.7098231082210263  0.0098332544326143
  0.5093231266301728  0.8071578415821932  0.0767679582475692
  0.5072598726346944  0.1699335787035654  0.1303552213547459
  0.4402537265119037  0.1500543108514959  0.2463537139000002
  0.4400035083753189  0.8680701744418695  0.2466279424604408
  0.5071432558225912  0.9738619163008985  0.1939896142462555
  0.5766400384307480  0.1489962546785114  0.7693732624748194
  0.5095274607676117  0.0430477079087790  0.8216621125402328
  0.5088840194226834  0.8468543406959166  0.8855041334401662
  0.5762908506466651  0.8662816611136243  0.7697385491072902
  0.3216966288388011  0.4736966776733357  0.0100218821333300
  0.2704385749134633  0.3674693863615262  0.0778502258450831
  0.3871894633509408  0.6702632433736113  0.0082917629641054
  0.2722329477811130  0.6488073974874039  0.9396433350641296
  0.1281351727735967  0.0085284473835174  0.3459544765450746
  0.2434400052795448  0.9405243824219653  0.3679257636447213
  0.1940112279048156  0.0091675753728587  0.5426605837358974
  0.2453685245628364  0.0769936004715084  0.6484172265994080
  0.2397658205601584  0.2731421866286437  0.2417827411861535
  0.1255033460112345  0.2774422020080601  0.1675164272509953
  0.2344369920262342  0.3480306300733414  0.8930326857331079
  0.1243183389073167  0.2784950620716514  0.8511454645423085
  0.2384227940897948  0.6652666378566859  0.1251219090020330
  0.1691082224063506  0.6232237806737909  0.2350808519322261
  0.2404645660821041  0.7401020501535271  0.7752658461331376
  0.1682658806755621  0.6247369527968160  0.7782830574577890
  0.2786906654429059  0.1242527386864655  0.3521290092558473
  0.3476690134516459  0.2348872514731115  0.3933957303561464
  0.3493404357469023  0.7799888986440058  0.3912345588995388
  0.2766602659114036  0.7743943783752110  0.2765733952026372
  0.3907508555051469  0.1677044853974278  0.7372983016750597
  0.2755894080142346  0.2402328315567111  0.7425571648211233
  0.2804931527543648  0.8927570673217247  0.6683770887301632
  0.3908179945101738  0.8507644961124508  0.7377108906051456
  0.6293368510579073  0.3461136961905501  0.0074064265577830
  0.7441692338531718  0.3677942992760408  0.0761521742332210
  0.6945706824748887  0.5430182128701022  0.0064213370377847
  0.7461650257952250  0.6490041302076373  0.9386797510965326
  0.8215433490864890  0.0071790164275218  0.4741217555263458
  0.7702491252758691  0.9394000234601875  0.3683234253926556
  0.8876124928771233  0.0075931506914679  0.6707844187838465
  0.7724228394737755  0.0756757236461047  0.6488809345460154
  0.7763797286607791  0.2769760565449988  0.2405760433291992
  0.8486388395762164  0.3922909139338601  0.2376337540060934
  0.7788030802718016  0.3510929306230952  0.8907423358794299
  0.8486841553363037  0.3928400467688225  0.7809440209112488
  0.7818479325438716  0.6685694722048118  0.1236128417199381
  0.8920141078832193  0.7378185687311413  0.1659615801946572
  0.7770396101594115  0.7423212590946936  0.7746264446486731
  0.8912149806255318  0.7380787823430748  0.8489459840190779
  0.7359008445087274  0.1237421884582087  0.3477163354257845
  0.6258252618321223  0.1659776709336424  0.2781258351686639
  0.6252321742736603  0.8487938079789097  0.2789869922780698
  0.7403534574704824  0.7762782644060401  0.2741733017884408
  0.6676355817436345  0.2368217222086554  0.6251147202959784
  0.7405796609096738  0.2425089245350371  0.7398011393297407
  0.7376586253527059  0.8914902128542634  0.6646968032599548
  0.6689508382811061  0.7807760409862793  0.6231632535262737
  0.3069749669063454  0.5771905729901451  0.5062074926532504
  0.2096332148708474  0.5100084681880398  0.4384392484788060
  0.7094977515624975  0.4385863712339399  0.5097255142261276
  0.8069244239246794  0.5058827782317573  0.5773438039302543
  0.1495646285889059  0.4385885744016195  0.7445187530116887
  0.1707211801932665  0.5067740117920831  0.6291975184478386
  0.8697660523629466  0.5784430423644242  0.7450940675075937
  0.9746115306136340  0.5089203835734860  0.6938812045149831
  0.1473377026839095  0.4372520616153857  0.2707722370243788
  0.0426932530786179  0.5072463640452737  0.3218396882917548
  0.8672584961989034  0.5780749354698567  0.2716874020463236
  0.8463156127108108  0.5094626333590063  0.3867036516503313
  0.3462114015555593  0.3865018934096776  0.5078469276780052
  0.3669687235121811  0.2723598748156633  0.5777068382594606
  0.5424018894909656  0.3219223023006405  0.5064492763379657
  0.6476239444393534  0.2698933848051031  0.4381664923310665
  0.4744253154888385  0.6939933242762694  0.5096813979010227
  0.3690949068939667  0.7461269926293501  0.5777160095064731
  0.6704969313741200  0.6294005888552346  0.5082599211318036
  0.6494513394590447  0.7437518575344031  0.4387024047470986
  0.3016980150212798 -0.0054548318419315 -0.0044743689205316
  0.2127344964084575  0.0188513019216459  0.0153843149265640
  0.8029676417368086 -0.0053512035825740 -0.0037649267373701
  0.7134940429055587  0.0154012698847654  0.0177645927024894
  0.0032546680155949  0.2558651076131987  0.5570769504128508
  0.0016800447444725  0.2553884880684324  0.4627501294010980
  0.0069509886675301  0.7613647521018492  0.5569165683505459
  0.0040174356251150  0.7613702130969303  0.4626203856596989
  0.5095025376131687  0.5569534042348186  0.2547350513321802
  0.5075650835961329  0.4626474343329640  0.2565170360509894
  0.5110870954571001  0.5569962616469646  0.7604688656799893
  0.5088157123089182  0.4626947385328239  0.7619032539921325
  0.0056591935053923  0.5553586312432377  0.0129255001956543
  0.0105678532968828  0.4615837688429517  0.0040584656540707
  0.5546723626340143  0.0101891974482986  0.5173365916610710
  0.4622101866949356  0.0057069293629220  0.4992790105861796
!


###############################################
# exécution
time mpirun -n $NSLOTS vasp
###############################################

cp OSZICAR OSZICAR-$i
cp OUTCAR OUTCAR-$i
cp CONTCAR CONTCAR-$i
E=`tail -1 OSZICAR` ; echo $i $E >>VOLUME.dat

done

# purge des fichiers
rm vasp

